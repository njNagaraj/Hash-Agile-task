// Check if there are enough available consecutive seats
If(
    CountRows(varSAvailableSeats) >= varSTotalPassenger,

    ForAll(
        FirstN(varSAvailableSeats, varSTotalPassenger),
        Patch(
            STrainSeatDetails,
            ThisRecord,
            { isBooked: 1 }
        )
    );
    
    // Reduce the seat count in TrainIndividualCoachDetails
    Patch(
        STrainIndividualCoachDetails,
        LookUp(STrainIndividualCoachDetails, TrainIndividualCoachDetailsID = varSIndividualCoachID),
        { SeatCount: SeatCount - varPerCount }
    )
);



// Store the information in the BookingAlottedTickets table
Patch(
    SAlottedTrainTickets,
    Defaults(SAlottedTrainTickets),
    {
        BookingPNR: varBookingPNR,
        TrainNo: varSTrainNo,
        PassengerID: varUserID,
        TicketType: varSCoachType,           // e.g., Sleeper/AC
        NoOfTickets: varSTotalPassenger,         // Number of tickets
        From: varSFromStationCode,            // Starting station
        To: varSToStationCode,                // Destination station
        BookingDate: Today(),                // Current date as booking date
        BookingTime: Text(Now(), "[$-en-US]hh:mm"),  // Current time as booking time
        JourneyDate: varSelectedDay,         // Selected journey date
        TotalKm: varSTotalKm,                 // Total kilometers between stations
        Coach: varCoach,                     // Selected coach
        SeatNo: varSeatNo                    // Seat number
    }
);
